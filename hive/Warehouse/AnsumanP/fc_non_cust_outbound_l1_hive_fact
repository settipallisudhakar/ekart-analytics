INSERT OVERWRITE TABLE fc_non_cust_outbound_l1_hive_fact
select
ore.outbound_request_id as outbound_request_id,
ore.outbound_request_destination_party_type as outbound_request_destination_party_type,
ore.outbound_request_created_at as outbound_request_created_timestamp,
ore.outbound_request_created_by as outbound_request_created_by,
ore.outbound_request_type as outbound_request_type,
ore.outbound_request_company as outbound_request_company,
ore.outbound_request_destination_party_id as outbound_request_destination_party_id,
ore.outbound_request_warehouse_id as outbound_request_warehouse_id,
ore.outbound_request_external_id as outbound_request_external_id,
ore.outbound_request_status as outbound_request_status,
ore.outbound_request_updated_at as outbound_request_updated_timestamp,
ore.outbound_request_shipment_id as outbound_request_consignment_id,
ore.outbound_request_created_date_key as outbound_request_created_date_key,
ore.outbound_request_created_time_key as outbound_request_created_time_key,
ore.outbound_request_updated_date_key as outbound_request_updated_date_key,
ore.outbound_request_updated_time_key as outbound_request_updated_time_key,
ore.outbound_request_warehouse_dim_key as outbound_request_warehouse_dim_key,
r.reservation_id as outbound_request_item_id,
r.reservation_created_timestamp as outbound_request_item_created_timestamp,
r.reservation_created_date_key as outbound_request_item_created_date_key,
r.reservation_created_time_key as outbound_request_item_created_time_key,
r.reservation_inventory_item_id as outbound_request_item_inventory_item_id,
r.reservation_product_key as outbound_request_item_product_key,
r.reservation_quantity as outbound_request_item_quantity,
r.reservation_status as outbound_request_item_status,
r.reservation_updated_timestamp as outbound_request_item_updated_timestamp,
r.reservation_updated_date_key as outbound_request_item_updated_date_key,
r.reservation_updated_time_key as outbound_request_item_updated_time_key,
r.reservation_cancelled_timestamp as outbound_request_item_cancelled_timestamp,
r.reservation_cancelled_date_key as outbound_request_item_cancelled_date_key,
r.reservation_cancelled_time_key as outbound_request_item_cancelled_time_key,
r.picklist_item_id as picklist_item_id,
r.picklist_item_actual_location as picklist_item_actual_location,
r.picklist_item_actual_quantity as picklist_item_actual_quantity,
r.picklist_item_lost_quantity as picklist_item_lost_quantity,
r.picklist_item_status as picklist_item_status,
r.picklist_item_suggested_location as picklist_item_suggested_location,
r.picklist_item_suggested_quantity as picklist_item_suggested_quantity,
r.picklist_item_picked_timestamp as picklist_item_picked_timestamp,
r.picklist_item_picked_date_key as picklist_item_picked_date_key,
r.picklist_item_picked_time_key as picklist_item_picked_time_key,
r.picklist_item_cancelled_timestamp as picklist_item_cancelled_timestamp,
r.picklist_item_cancelled_date_key as picklist_item_cancelled_date_key,
r.picklist_item_cancelled_time_key as picklist_item_cancelled_time_key,
r.picklist_id as picklist_id,
r.picklist_assigned_to as picklist_assigned_to,
r.picklist_compledted_by as picklist_compledted_by,
r.picklist_created_timestamp as picklist_created_timestamp,
r.picklist_created_date_key as picklist_created_date_key,
r.picklist_created_time_key as picklist_created_time_key,
r.picklist_created_by as picklist_created_by,
r.picklist_display_id as picklist_display_id,
r.picklist_status as picklist_status,
r.picklist_updated_timestamp as picklist_updated_timestamp,
r.picklist_updated_date_key as picklist_updated_date_key,
r.picklist_updated_time_key as picklist_updated_time_key,
r.picklist_location_type as picklist_location_type,
r.reservation_ship_method as outbound_request_item_ship_method,
r.reservation_shipment_item_id as outbound_request_item_consignment_item_id,
r.reservation_source_storage_location_id as outbound_request_item_source_storage_location_id,
r.picklist_item_entity_type as picklist_item_entity_type,
r.picklist_entity_type as picklist_entity_type,
si.shipment_item_is_excess as consignment_item_is_excess,
si.shipment_item_status as consignment_item_status,
si.shipment_item_updated_timestamp as consignment_item_updated_timestamp,
si.shipment_item_updated_date_key as consignment_item_updated_date_key,
si.shipment_item_updated_time_key as consignment_item_updated_time_key,
si.shipment_item_cancelled_timestamp as consignment_item_cancelled_timestamp,
si.shipment_item_cancelled_date_key as consignment_item_cancelled_date_key,
si.shipment_item_cancelled_time_key as consignment_item_cancelled_time_key,
si.shimpment_created_timestamp as consignment_created_timestamp,
si.shimpment_created_date_key as consignment_created_date_key,
si.shimpment_created_time_key as consignment_created_time_key,
si.shipment_status as consignment_status,
si.shipment_updated_timestamp as consignment_updated_timestamp,
si.shipment_updated_date_key as consignment_updated_date_key,
si.shipment_updated_time_key as consignment_updated_time_key,
si.shipment_cancelled_timestamp as consignment_cancelled_timestamp,
si.shipment_cancelled_date_key as consignment_cancelled_date_key,
si.shipment_cancelled_time_key as consignment_cancelled_time_key,
si.shipment_dispatched_timestamp as consignment_dispatched_timestamp,
si.shipment_dispatched_date_key as consignment_dispatched_date_key,
si.shipment_dispatched_time_key as consignment_dispatched_time_key,
si.shipment_item_polymorphic_id as consignment_item_polymorphic_id,
si.shipment_item_polymorphic_type as consignment_item_polymorphic_type,
si.shipment_item_quantity_lost_during_dispatch as consignment_item_quantity_lost_during_dispatch,
si.shipment_item_quantity_packed as consignment_item_quantity_packed,
si.shipment_item_quantity_received as consignment_item_quantity_received,
si.shipment_packed_timestamp as consignment_packed_timestamp,
si.shipment_packed_date_key as consignment_packed_date_key,
si.shipment_packed_time_key as consignment_packed_time_key,
si.shipment_packed_by as consignment_packed_by,
if(ore.outbound_request_type='iwit',lookupkey('warehouse_id',ore.outbound_request_destination_party_id),NULL) as outbound_request_destination_warehouse_dim_key,
ore.ta_pickup_date_key as ta_pickup_date_key,
ore.ta_pickup_time_key as ta_pickup_time_key,
ore.ta_expected_delivery_date_key as ta_expected_delivery_date_key,
ore.ta_expected_delivery_time_key as ta_expected_delivery_time_key,
ore.ta_created_date_key as ta_created_date_key,
ore.ta_created_time_key as ta_created_time_key,
ore.ta_updated_date_key as ta_updated_date_key,
ore.ta_updated_time_key as ta_updated_time_key,
ore.ta_requested_by as ta_requested_by,
ore.ta_vendor_name as ta_vendor_name,
ore.ta_tracking_id as ta_tracking_id,
ore.ta_warehouse_id as ta_warehouse_id,
pl.pl_request_id as pl_request_id,
pl.internal_id as pl_internal_id,
pl.pl_request_type as pl_request_type,
pl.requestor_type as pl_requestor_type,
pl.inventory_type as pl_inventory_type,
pl.pl_mode as pl_mode,
pl.pl_request_created_at as pl_request_created_at,
pl.pl_request_created_date_key as pl_request_created_date_key,
pl.pl_request_created_time_key as pl_request_created_time_key,
pl.pl_request_updated_at as pl_request_updated_at,
pl.pl_request_updated_date_key as pl_request_updated_date_key,
pl.pl_request_updated_time_key as pl_request_updated_time_key,
pl.current_status as pl_current_status,
pl.expected_dispatch_date as pl_expected_dispatch_date,
pl.expected_dispatch_date_key as pl_expected_dispatch_date_key,
pl.expected_dispatch_time_key as pl_expected_dispatch_time_key,
pl.tracking_id as pl_tracking_id,
pl.source_external_id as pl_source_external_id,
pl.source_type as pl_source_type,
pl.source_pincode as pl_source_pincode,
pl.destination_external_id as pl_destination_external_id,
pl.destination_type as pl_destination_type,
pl.destination_pincode as pl_destination_pincode,
pl.consignment_group_id as pl_consignment_group_id,
pl.creation_in_progress_at as pl_creation_in_progress_at,
pl.creation_in_progress_date_key as pl_creation_in_progress_date_key,
pl.creation_in_progress_time_key as pl_creation_in_progress_time_key,
pl.status_new_at as pl_status_new_at,
pl.status_new_date_key as pl_status_new_date_key,
pl.status_new_time_key as pl_status_new_time_key,
pl.status_open_at as pl_status_open_at,
pl.status_open_date_key as pl_status_open_date_key,
pl.status_open_time_key as pl_status_open_time_key,
pl.status_approved_at as pl_status_approved_at,
pl.status_approved_date_key as pl_status_approved_date_key,
pl.status_approved_time_key as pl_status_approved_time_key,
pl.status_cancelled_at as pl_status_cancelled_at,
pl.status_cancelled_date_key as pl_status_cancelled_date_key,
pl.status_cancelled_time_key as pl_status_cancelled_time_key,
pl.status_closed_at as pl_status_closed_at,
pl.status_closed_date_key as pl_status_closed_date_key,
pl.status_closed_time_key as pl_status_closed_time_key,
pl.status_pending_at as pl_status_pending_at,
pl.status_pending_date_key as pl_status_pending_date_key,
pl.status_pending_time_key as pl_status_pending_time_key,
sg.ship_group_id as ship_group_id,
sg.internal_id as sg_internal_id,
sg.external_tracking_id as sg_external_tracking_id,
sg.ship_group_type as ship_group_type,
sg.ship_group_created_at as ship_group_created_at,
sg.ship_group_created_date_key as ship_group_created_date_key,
sg.ship_group_created_time_key as ship_group_created_time_key,
sg.ship_group_updated_at as ship_group_updated_at,
sg.ship_group_updated_date_key as ship_group_updated_date_key,
sg.ship_group_updated_time_key as ship_group_updated_time_key,
sg.ship_group_current_status as ship_group_current_status,
sg.ship_group_isrejected as ship_group_isrejected,
sg.expected_delivery_date as sg_expected_delivery_date,
sg.expected_delivery_date_key as sg_expected_delivery_date_key,
sg.expected_delivery_time_key as sg_expected_delivery_time_key,
sg.expected_dispatch_date as sg_expected_dispatch_date,
sg.expected_dispatch_date_key as sg_expected_dispatch_date_key,
sg.expected_dispatch_time_key as sg_expected_dispatch_time_key,
sg.actual_delivery_date as sg_actual_delivery_date,
sg.actual_delivery_date_key as sg_actual_delivery_date_key,
sg.actual_delivery_time_key as sg_actual_delivery_time_key,
sg.receiving_hub_name as sg_receiving_hub_name,
sg.receiving_hub_id as sg_receiving_hub_id,
sg.receiving_hub_type as sg_receiving_hub_type,
sg.lost_quantity as sg_lost_quantity,
sg.status_creation_in_progress_at as sg_status_creation_in_progress_at,
sg.status_creation_in_progress_date_key as sg_status_creation_in_progress_date_key,
sg.status_creation_in_progress_time_key as sg_status_creation_in_progress_time_key,
sg.status_created_at as sg_status_created_at,
sg.status_created_date_key as sg_status_created_date_key,
sg.status_created_time_key as sg_status_created_time_key,
sg.status_ready_for_pickup_at as sg_status_ready_for_pickup_at,
sg.status_ready_for_pickup_date_key as sg_status_ready_for_pickup_date_key,
sg.status_ready_for_pickup_time_key as sg_status_ready_for_pickup_time_key,
sg.status_warehouse_dispatched_at as sg_status_warehouse_dispatched_at,
sg.status_warehouse_dispatched_date_key as sg_status_warehouse_dispatched_date_key,
sg.status_warehouse_dispatched_time_key as sg_status_warehouse_dispatched_time_key,
sg.status_dispatched_at as sg_status_dispatched_at,
sg.status_dispatched_date_key as sg_status_dispatched_date_key,
sg.status_dispatched_time_key as sg_status_dispatched_time_key,
sg.status_returned_at as sg_status_returned_at,
sg.status_returned_date_key as sg_status_returned_date_key,
sg.status_returned_time_key as sg_status_returned_time_key,
sg.status_received_at as sg_status_received_at,
sg.status_received_date_key as sg_status_received_date_key,
sg.status_received_time_key as sg_status_received_time_key,
sg.status_rejected_at as sg_status_rejected_at,
sg.status_rejected_date_key as sg_status_rejected_date_key,
sg.status_rejected_time_key as sg_status_rejected_time_key,
sg.status_completed_at as sg_status_completed_at,
sg.status_completed_date_key as sg_status_completed_date_key,
sg.status_completed_time_key as sg_status_completed_time_key,
sg.status_cancelled_at as sg_status_cancelled_at,
sg.status_cancelled_date_key as sg_status_cancelled_date_key,
sg.status_cancelled_time_key as sg_status_cancelled_time_key,
lookupkey('storage_location_storage_id',concat(r.reservation_source_storage_location_id,r.warehouse_company))  as ori_storage_location_id_key
from
bigfoot_external_neo.scp_warehouse__fc_outbound_requests_l0_hive_fact ore
Left outer join bigfoot_external_neo.scp_warehouse__fc_reservation_l0_hive_fact r
on (ore.outbound_request_id =r.reservation_outbound_request_id
and
ore.outbound_request_company=r.warehouse_company and r.reservation_outbound_type='non_customer_reservation')
Left outer join  (select distinct
shipment_item_is_excess,
shipment_item_status,
shipment_item_updated_timestamp,
shipment_item_updated_date_key,
shipment_item_updated_time_key,
shipment_item_cancelled_timestamp,
shipment_item_cancelled_date_key,
shipment_item_cancelled_time_key,
shimpment_created_timestamp,
shimpment_created_date_key,
shimpment_created_time_key,
shipment_status,
shipment_updated_timestamp,
shipment_updated_date_key,
shipment_updated_time_key,
shipment_cancelled_timestamp,
shipment_cancelled_date_key,
shipment_cancelled_time_key,
shipment_dispatched_timestamp,
shipment_dispatched_date_key,
shipment_dispatched_time_key,
shipment_item_polymorphic_id,
shipment_item_polymorphic_type,
shipment_item_quantity_lost_during_dispatch,
shipment_item_quantity_packed,
shipment_item_quantity_received,
shipment_packed_timestamp,
shipment_packed_date_key,
shipment_packed_time_key,
shipment_packed_by,
shipment_item_id,
warehouse_company from bigfoot_external_neo.scp_warehouse__fc_shipment_item_l0_hive_fact
where  shipment_entity_type = 'consignment') si
on (r.reservation_shipment_item_id= si.shipment_item_id and r.warehouse_company=si.warehouse_company)
left join bigfoot_external_neo.scp_warehouse__fc_portkey_pl_request_l0_hive_fact pl
on (ore.outbound_request_external_id = pl.external_id)
left join bigfoot_external_neo.scp_warehouse__fc_portkey_shipment_group_l0_hive_fact sg
on (ore.outbound_request_external_id=sg.external_id)
